import { app, BrowserWindow } from 'electron';
import { getAssetURL } from 'electron-snowpack';
import sharp from 'sharp';

let mainWindow: BrowserWindow | null | undefined;

function createMainWindow(): BrowserWindow {
  const window = new BrowserWindow();

  if (process.env.MODE !== 'production') {
    window.webContents.openDevTools();
  }

  window.loadURL(getAssetURL('index.html'));

  window.on('closed', (): void => {
    mainWindow = null;
  });

  window.webContents.on('devtools-opened', (): void => {
    window.focus();
    setImmediate((): void => {
      window.focus();
    });
  });

  return window;
}

// quit application when all windows are closed
app.on('window-all-closed', (): void => {
  // on macOS it is common for applications to stay open until the user explicitly quits
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

app.on('activate', (): void => {
  // on macOS it is common to re-create a window even after all windows have been closed
  if (mainWindow === null) {
    mainWindow = createMainWindow();
  }
});

// create main BrowserWindow when electron is ready
app.on('ready', (): void => {
  mainWindow = createMainWindow();
  
  const imageBase64 =
    'data:image/png;base64,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';

  const uri = imageBase64.split(';base64,').pop();

  const imgBuffer = Buffer.from(uri, 'base64');
  sharp(imgBuffer)
    .resize(52, 52)
    .toBuffer()
    .then((data) => {
      console.log('success');
    })
    .catch((err) => console.log(`Resize failed ${err}`));
});
